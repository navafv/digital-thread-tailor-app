{% extends 'tailor_app/base.html' %}

{% block title %}{{ customer.name }} | The Digital Thread{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h1>{{ customer.name }}</h1>
        <p class="lead text-muted">
            <i class="bi bi-telephone"></i> {{ customer.phone }} | <i class="bi bi-envelope"></i> {{ customer.email|default:"N/A" }}
        </p>
    </div>
    <a href="{% url 'edit_customer' customer.pk %}" class="btn btn-secondary"><i class="bi bi-pencil-square"></i> Edit Customer</a>
</div>

<div class="row">
    <!-- Orders Section -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4>Orders</h4>
                <a href="{% url 'add_order' customer.pk %}" class="btn btn-success btn-sm"><i class="bi bi-plus-circle"></i> New Order</a>
            </div>
            <div class="list-group list-group-flush">
                {% for order in customer.orders.all %}
                <a href="{% url 'order_detail' order.pk %}" class="list-group-item list-group-item-action">
                    <strong>{{ order.garment_type }}</strong> - Due: {{ order.due_date|date:"F d, Y" }}
                    <span class="float-end badge bg-primary">{{ order.status }}</span>
                </a>
                {% empty %}
                <div class="list-group-item">No orders for this customer yet.</div>
                {% endfor %}
            </div>
        </div>
    </div>
    <!-- Measurements Section -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header"><h4>Measurements</h4></div>
            <div class="list-group list-group-flush">
                {% for m in customer.measurements.all %}
                <div class="list-group-item">
                    <strong>{{ m.name }}:</strong> {{ m.value }}
                    <span class="float-end">
                        <a href="{% url 'edit_measurement' m.pk %}" class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></a>
                        <form action="{% url 'delete_measurement' m.pk %}" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this measurement?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                        </form>
                    </span>
                </div>
                {% empty %}
                <div class="list-group-item">No measurements saved.</div>
                {% endfor %}
            </div>
            <div class="card-footer">
                <form action="{% url 'add_measurement' customer.pk %}" method="post">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="text" name="name" class="form-control" placeholder="Name" required>
                        <input type="number" step="0.01" name="value" class="form-control" placeholder="Value" required>
                        <button class="btn btn-secondary" type="submit"><i class="bi bi-plus"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

