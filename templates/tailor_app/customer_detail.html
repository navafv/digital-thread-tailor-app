<!-- tailor_app/templates/tailor_app/customer_detail.html -->
{% extends 'tailor_app/base.html' %}

{% block title %}{{ customer.name }}{% endblock %}

{% block content %}
<div class="flex justify-between items-center">
    <h2 class="my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200">{{ customer.name }}</h2>
    <div class="flex justify-between items-center">
        {% if not customer.client_account %}
            <a href="{% url 'tailor_app:invite_customer_to_portal' customer.pk %}" class="mr-2 px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                Invite to Portal
            </a>
        {% else %}
            <button disabled class="mr-2 px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                Portal Active
            </button>
        {% endif %}
        <a href="{% url 'tailor_app:edit_customer' customer.pk %}" class="px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
            Edit Customer
        </a>
    </div>
</div>

{% comment %} <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ customer.name }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        {% if not customer.client_account %}
            <a href="{% url 'tailor_app:invite_customer_to_portal' customer.pk %}" class="btn btn-info me-2"><i data-feather="send" class="me-1"></i> Invite to Portal</a>
        {% else %}
             <button class="btn btn-outline-success me-2" disabled><i data-feather="check-circle" class="me-1"></i> Portal Active</button>
        {% endif %}
        <a href="{% url 'tailor_app:edit_customer' customer.pk %}" class="btn btn-secondary"><i data-feather="edit-2" class="me-1"></i> Edit Customer</a>
    </div>
</div> {% endcomment %}

<div class="grid gap-6 mb-8 md:grid-cols-2">
    <div>
        <div class="min-w-0 p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800 mb-4">
            <h4 class="text-lg mb-4 font-semibold text-gray-600 dark:text-gray-300">
                Contact Information
            </h4>
            <div class="text-gray-600 dark:text-gray-400">
                <p class="mb-2"><strong>Phone:</strong> {{ customer.phone }}</p>
                <p class="mb-2"><strong>Email:</strong> {{ customer.email|default:"N/A" }}</p>
                <p class="mb-2"><strong>Address:</strong> {{ customer.address|default:"N/A" }}</p>
            </div>
        </div>
        <div class="min-w-0 p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800">
            <div class="flex justify-between items-center">
                <h4 class="text-lg mb-4 font-semibold text-gray-600 dark:text-gray-300">
                    Measurements
                </h4>
                <button @click="openModal" class="flex items-center justify-between px-2 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple" aria-label="Like">
                    <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" fill-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <ul class="text-gray-600 dark:text-gray-400">
                {% for measurement in customer.measurements.all %}
                <li>
                    <strong>{{ measurement.name }}:</strong> {{ measurement.value }}
                </li>
                {% empty %}
                <li class="text-center">No measurements added yet.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="min-w-0 p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <div class="flex justify-between items-center">
            <h4 class="text-lg mb-4 font-semibold text-gray-600 dark:text-gray-300">
                Orders
            </h4>
            <a href="{% url 'tailor_app:add_order' customer.pk %}" class="px-4 py-2 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
                New Order
            </a>
        </div>
        {% for order in customer.orders.all %}
            <div class="text-gray-600 dark:text-gray-400 mt-2">
                <a href="{% url 'tailor_app:order_detail' order.id %}" class="mb-2">
                    <div class="flex justify-between">
                        <h6 class="mb-1 font-bold">Order #{{ order.id }}: {{ order.item }}</h6>
                        <small>Due: {{ order.due_date|date:"Y-m-d" }}</small>
                    </div>
                    <p class="mb-1"><span class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100 text-xs">{{ order.status }}</span></p>
                </a>
                <hr class="mt-2">
            </div>
        {% empty %}
            <p class="text-center text-gray-600 dark:text-gray-400">This customer has no orders.</p>
        {% endfor %}
    </div>
</div>

{% comment %} <div class="row">
    <!-- Left Column: Info & Measurements -->
    <div class="col-lg-4">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light border-0"><h5 class="mb-0">Contact Information</h5></div>
            <div class="card-body">
                <p><strong>Phone:</strong> {{ customer.phone }}</p>
                <p><strong>Email:</strong> {{ customer.email|default:"N/A" }}</p>
                <p><strong>Address:</strong> {{ customer.address|default:"N/A" }}</p>
            </div>
        </div>

        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light border-0 d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Measurements</h5>
                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addMeasurementModal"><i data-feather="plus"></i></button>
            </div>
            <ul class="list-group list-group-flush">
                {% for measurement in customer.measurements.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div><strong>{{ measurement.name }}:</strong> {{ measurement.value }}</div>
                    <!-- Edit/Delete could be modals or separate pages -->
                </li>
                {% empty %}
                <li class="list-group-item text-muted">No measurements added yet.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Right Column: Orders -->
    <div class="col-lg-8">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-light border-0 d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Orders</h5>
                <a href="{% url 'tailor_app:add_order' customer.pk %}" class="btn btn-primary"><i data-feather="plus" class="me-1"></i> New Order</a>
            </div>
            <div class="list-group list-group-flush">
                {% for order in customer.orders.all %}
                <a href="{% url 'tailor_app:order_detail' order.id %}" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1 fw-bold">Order #{{ order.id }}: {{ order.item }}</h6>
                        <small>Due: {{ order.due_date|date:"Y-m-d" }}</small>
                    </div>
                    <p class="mb-1"><span class="badge rounded-pill text-bg-primary">{{ order.status }}</span></p>
                </a>
                {% empty %}
                <div class="list-group-item text-center p-5"><p class="text-muted">This customer has no orders.</p></div>
                {% endfor %}
            </div>
        </div>
    </div>
</div> {% endcomment %}

{% comment %} <!-- Add Measurement Modal -->
<div class="modal fade" id="addMeasurementModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Measurement</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form action="{% url 'tailor_app:add_measurement' customer.pk %}" method="post">
            {% csrf_token %}
            <div class="form-floating mb-3">
                {{ measurement_form.name }}
                <label for="id_name">Measurement Name (e.g., Chest)</label>
            </div>
             <div class="form-floating mb-3">
                {{ measurement_form.value }}
                <label for="id_value">Value (e.g., 38.5)</label>
            </div>
            <button type="submit" class="btn btn-success w-100">Save Measurement</button>
        </form>
      </div>
    </div>
  </div>
</div> {% endcomment %}

<!-- Modal backdrop. This what you want to place close to the closing body tag -->
<div
    x-show="isModalOpen"
    x-transition:enter="transition ease-out duration-150"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 z-30 flex items-end bg-black bg-opacity-50 sm:items-center sm:justify-center"
>
    <!-- Modal -->
    <div
    x-show="isModalOpen"
    x-transition:enter="transition ease-out duration-150"
    x-transition:enter-start="opacity-0 transform translate-y-1/2"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0  transform translate-y-1/2"
    @click.away="closeModal"
    @keydown.escape="closeModal"
    class="w-full px-6 py-4 overflow-hidden bg-white rounded-t-lg dark:bg-gray-800 sm:rounded-lg sm:m-4 sm:max-w-xl"
    role="dialog"
    id="modal"
    >
    <!-- Remove header if you don't want a close icon. Use modal body to place modal tile. -->
    <form action="{% url 'tailor_app:add_measurement' customer.pk %}" method="post">
        {% csrf_token %}
        <header class="flex justify-end">
            <button
            class="inline-flex items-center justify-center w-6 h-6 text-gray-400 transition-colors duration-150 rounded dark:hover:text-gray-200 hover: hover:text-gray-700"
            aria-label="close"
            @click="closeModal"
            >
            <svg
                class="w-4 h-4"
                fill="currentColor"
                viewBox="0 0 20 20"
                role="img"
                aria-hidden="true"
            >
                <path
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"
                fill-rule="evenodd"
                ></path>
            </svg>
            </button>
        </header>
        <!-- Modal body -->
        <div class="mt-4 mb-6 text-sm text-gray-700 dark:text-gray-400">
            <!-- Modal title -->
            <p
            class="mb-2 text-lg font-semibold text-gray-700 dark:text-gray-300"
            >
            Add New Measurement
            </p>
            <!-- Modal description -->
            <div class="px-4 py-3 mb-8 bg-white rounded-lg shadow-md dark:bg-gray-800">
                {% for field in form %}
                    <label class="block text-sm mb-4">
                        <span class="text-gray-700 dark:text-gray-400">{{ field.label }}</span>
                        {{ field }}
                        {% if field.errors %}
                            <p class="text-red-500 text-xs mt-1">{{ field.errors|striptags }}</p>
                        {% endif %}
                    </label>
                {% endfor %}
            </div>
        </div>
        <footer
            class="flex flex-col items-center justify-end px-6 py-3 -mx-6 -mb-4 space-y-4 sm:space-y-0 sm:space-x-6 sm:flex-row bg-gray-50 dark:bg-gray-800"
        >
            <button
            @click="closeModal"
            class="w-full px-5 py-3 text-sm font-medium leading-5 text-white text-gray-700 transition-colors duration-150 border border-gray-300 rounded-lg dark:text-gray-400 sm:px-4 sm:py-2 sm:w-auto active:bg-transparent hover:border-gray-500 focus:border-gray-500 active:text-gray-500 focus:outline-none focus:shadow-outline-gray"
            >
            Cancel
            </button>
            <button
            type="submit"
            class="w-full px-5 py-3 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-lg sm:w-auto sm:px-4 sm:py-2 active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple"
            >
            Save
            </button>
        </footer>
    </form>
    </div>
</div>
<!-- End of modal backdrop -->
{% endblock %}

